function t(){t=function(){return a};var a={},e=Object.prototype,u=e.hasOwnProperty,s=Object.defineProperty||function(t,e,r){t[e]=r.value},r="function"==typeof Symbol?Symbol:{},n=r.iterator||"@@iterator",o=r.asyncIterator||"@@asyncIterator",i=r.toStringTag||"@@toStringTag";function c(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{c({},"")}catch(t){c=function(t,e,r){return t[e]=r}}function f(t,e,r,n){var o,i,a,c,e=e&&e.prototype instanceof p?e:p,e=Object.create(e.prototype),n=new L(n||[]);return s(e,"_invoke",{value:(o=t,i=r,a=n,c="suspendedStart",function(t,e){if("executing"===c)throw new Error("Generator is already running");if("completed"===c){if("throw"===t)throw e;return j()}for(a.method=t,a.arg=e;;){var r=a.delegate;if(r){r=function t(e,r){var n=e.iterator[r.method];if(void 0===n){if(r.delegate=null,"throw"===r.method){if(e.iterator.return&&(r.method="return",r.arg=void 0,t(e,r),"throw"===r.method))return h;r.method="throw",r.arg=new TypeError("The iterator does not provide a 'throw' method")}return h}n=l(n,e.iterator,r.arg);if("throw"===n.type)return r.method="throw",r.arg=n.arg,r.delegate=null,h;n=n.arg;return n?n.done?(r[e.resultName]=n.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=void 0),r.delegate=null,h):n:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,h)}(r,a);if(r){if(r===h)continue;return r}}if("next"===a.method)a.sent=a._sent=a.arg;else if("throw"===a.method){if("suspendedStart"===c)throw c="completed",a.arg;a.dispatchException(a.arg)}else"return"===a.method&&a.abrupt("return",a.arg);c="executing";r=l(o,i,a);if("normal"===r.type){if(c=a.done?"completed":"suspendedYield",r.arg===h)continue;return{value:r.arg,done:a.done}}"throw"===r.type&&(c="completed",a.method="throw",a.arg=r.arg)}})}),e}function l(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}a.wrap=f;var h={};function p(){}function d(){}function v(){}var r={},y=(c(r,n,function(){return this}),Object.getPrototypeOf),y=y&&y(y(E([]))),m=(y&&y!==e&&u.call(y,n)&&(r=y),v.prototype=p.prototype=Object.create(r));function g(t){["next","throw","return"].forEach(function(e){c(t,e,function(t){return this._invoke(e,t)})})}function w(a,c){var e;s(this,"_invoke",{value:function(r,n){function t(){return new c(function(t,e){!function e(t,r,n,o){var i,t=l(a[t],a,r);if("throw"!==t.type)return(r=(i=t.arg).value)&&"object"==typeof r&&u.call(r,"__await")?c.resolve(r.__await).then(function(t){e("next",t,n,o)},function(t){e("throw",t,n,o)}):c.resolve(r).then(function(t){i.value=t,n(i)},function(t){return e("throw",t,n,o)});o(t.arg)}(r,n,t,e)})}return e=e?e.then(t,t):t()}})}function x(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function b(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function L(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(x,this),this.reset(!0)}function E(e){if(e){var r,t=e[n];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length))return r=-1,(t=function t(){for(;++r<e.length;)if(u.call(e,r))return t.value=e[r],t.done=!1,t;return t.value=void 0,t.done=!0,t}).next=t}return{next:j}}function j(){return{value:void 0,done:!0}}return s(m,"constructor",{value:d.prototype=v,configurable:!0}),s(v,"constructor",{value:d,configurable:!0}),d.displayName=c(v,i,"GeneratorFunction"),a.isGeneratorFunction=function(t){t="function"==typeof t&&t.constructor;return!!t&&(t===d||"GeneratorFunction"===(t.displayName||t.name))},a.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,v):(t.__proto__=v,c(t,i,"GeneratorFunction")),t.prototype=Object.create(m),t},a.awrap=function(t){return{__await:t}},g(w.prototype),c(w.prototype,o,function(){return this}),a.AsyncIterator=w,a.async=function(t,e,r,n,o){void 0===o&&(o=Promise);var i=new w(f(t,e,r,n),o);return a.isGeneratorFunction(e)?i:i.next().then(function(t){return t.done?t.value:i.next()})},g(m),c(m,i,"Generator"),c(m,n,function(){return this}),c(m,"toString",function(){return"[object Generator]"}),a.keys=function(t){var e,r=Object(t),n=[];for(e in r)n.push(e);return n.reverse(),function t(){for(;n.length;){var e=n.pop();if(e in r)return t.value=e,t.done=!1,t}return t.done=!0,t}},a.values=E,L.prototype={constructor:L,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(b),!t)for(var e in this)"t"===e.charAt(0)&&u.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=void 0)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(r){if(this.done)throw r;var n=this;function t(t,e){return i.type="throw",i.arg=r,n.next=t,e&&(n.method="next",n.arg=void 0),!!e}for(var e=this.tryEntries.length-1;0<=e;--e){var o=this.tryEntries[e],i=o.completion;if("root"===o.tryLoc)return t("end");if(o.tryLoc<=this.prev){var a=u.call(o,"catchLoc"),c=u.call(o,"finallyLoc");if(a&&c){if(this.prev<o.catchLoc)return t(o.catchLoc,!0);if(this.prev<o.finallyLoc)return t(o.finallyLoc)}else if(a){if(this.prev<o.catchLoc)return t(o.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return t(o.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;0<=r;--r){var n=this.tryEntries[r];if(n.tryLoc<=this.prev&&u.call(n,"finallyLoc")&&this.prev<n.finallyLoc){var o=n;break}}var i=(o=o&&("break"===t||"continue"===t)&&o.tryLoc<=e&&e<=o.finallyLoc?null:o)?o.completion:{};return i.type=t,i.arg=e,o?(this.method="next",this.next=o.finallyLoc,h):this.complete(i)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),h},finish:function(t){for(var e=this.tryEntries.length-1;0<=e;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),b(r),h}},catch:function(t){for(var e=this.tryEntries.length-1;0<=e;--e){var r,n,o=this.tryEntries[e];if(o.tryLoc===t)return"throw"===(r=o.completion).type&&(n=r.arg,b(o)),n}throw new Error("illegal catch attempt")},delegateYield:function(t,e,r){return this.delegate={iterator:E(t),resultName:e,nextLoc:r},"next"===this.method&&(this.arg=void 0),h}},a}function e(t,e,r,n,o,i,a){try{var c=t[i](a),u=c.value}catch(t){return void r(t)}c.done?e(u):Promise.resolve(u).then(n,o)}function r(u){return function(){var t=this,c=arguments;return new Promise(function(r,n){var o=u.apply(t,c);function i(t){e(o,r,n,i,a,"next",t)}function a(t){e(o,r,n,i,a,"throw",t)}i(void 0)})}}function n(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function o(t,e,r){return e&&n(t.prototype,e),r&&n(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t}function i(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}var a=require("./renderer"),c=require("path"),u=require("fs"),f=require("./utils").convertSeconds,s=require("child_process").spawn,l=require("os").cpus().length,h=function(t){for(var e,r=c.parse(t).dir.split(c.sep),n=1;n<=r.length;n++)(e=r.slice(0,n).join(c.sep))&&!u.existsSync(e)&&u.mkdirSync(e)},p=function(e){u.readdirSync(e).forEach(function(t){u.unlinkSync(c.join(e,t))}),u.rmdirSync(e)},d=function(t,r){return t.reduce(function(t,e){return t||e===r||e.startsWith(r+"=")},!1)},v=o(function e(n){var q=this;if(!(this instanceof e))throw new TypeError("Cannot call a class as a function");i(this,"configuration",{}),i(this,"record",r(t().mark(function e(){var r,n,o,i,u,v,y,m,g,w,x,b,L,E,j,O,k,_,S,P,F,T,G,N;return t().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(r=Object.assign({roundToEvenWidth:!0,roundToEvenHeight:!0,url:"index.html",pixFmt:"yuv420p"},q.configuration||{}),n=c.resolve(process.cwd(),r.output||"video.mp4"),i=r.ffmpegPath||"ffmpeg",u=r.inputOptions||[],v=r.outputOptions||[],y=r.tempDir||r.frameDir,w=r.frameCache||!r.pipeMode,x=r.pipeMode,O=r.screenshotType||"png",L=w?(y=y||"onerec-"+(r.keepFrames?"frames-":"temp-")+(new Date).getTime(),"string"==typeof r.frameCache&&(y=c.join(r.frameCache,y)),y=c.resolve(c.parse(n).dir,y),S="."+O,c.resolve(y,"image-%09d"+S)):"",k=Object.assign({},r,{output:"",outputPattern:L}),m=r.fps||(r.frames&&r.duration?r.frames/r.duration:60),(g=r.threads||1)>l&&(g=l),_=function(){r.quiet||console.log.apply(this,arguments)},S=function(){var t,e;return h(n),e=x?"pipe:0":L,d(o=u,"-framerate")||(o=o.concat(["-framerate",m])),o=!x||"jpeg"!==O&&"jpg"!==O?o.concat(["-i",e]):o.concat(["-f","image2pipe","-vcodec","mjpeg","-i","-"]),o=(o=!d(v,"-pix_fmt")&&r.pixFmt?o.concat(["-pix_fmt",r.pixFmt]):o).concat(v),o=r.outputStream?(t=["-f",(e=r.outputStreamOptions||{}).format||"mp4"],(e=void 0===(e=e.movflags)?"frag_keyframe+empty_moov+faststart":e)&&(t=t.concat(["-movflags",e])),o.concat(t).concat(["pipe:1"])):o.concat(["-y",n]),r.audio&&(o=o.concat(["-ss",0,"-t",f(r.duration),"-i",r.audio])),(E=s(i,o)).stderr.setEncoding("utf8"),E.stderr.on("data",function(t){_(t)}),new Promise(function(t,e){E.on("close",function(){t()}),E.on("error",function(t){e(b=t)}),E.stdin.on("error",function(t){e(b=t)}),r.outputStream&&(E.stdout.on("error",function(t){e(b=t)}),E.stdout.pipe(r.outputStream))})},x&&(j=S(),k.frameProcessor=function(t){if(b)throw b;E.stdin.write(t)}),t.prev=17,1===g)return t.next=21,a(k);t.next=23;break;case 21:t.next=30;break;case 23:for(F=[],T=r.frames||r.duration*m||5*m,G=0,N=function(){var t=Math.floor(T/g--),e=G,r=e+t,n=Object.assign({},k,{shouldSkipFrame:function(t){t=t.frameCount;return t<=e||r<t}});F.push(a(n)),G=r,T-=t};1<=g;)N();return t.next=30,Promise.all(F);case 30:if(E&&E.stdin.end(),j)return t.next=34,j;t.next=36;break;case 34:t.next=38;break;case 36:return t.next=38,S();case 38:t.next=44;break;case 40:t.prev=40,t.t0=t.catch(17),P=t.t0,_(t.t0);case 44:if(w&&!r.keepFrames&&p(y),P)throw P;t.next=47;break;case 47:case"end":return t.stop()}},e,null,[[17,40]])}))),this.configuration=n});module.exports=v;
